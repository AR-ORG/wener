# Java 9

## Tips
* [JDK 9](http://openjdk.java.net/projects/jdk9/)
* [55 New Features in JDK 9](https://www.slideshare.net/SimonRitter/55-new-features-in-jdk-9)
* [Self-Contained Application Packaging](https://docs.oracle.com/javase/9/deploy/self-contained-application-packaging.htm#JSDPG583)

## Contents
* [JSR 379: JavaTM SE 9 Release Contents](https://jcp.org/en/jsr/detail?id=379)
* [Java9](http://openjdk.java.net/projects/jdk9/)
* [Countdown to Java 9 Release Date](http://www.java9countdown.xyz/)

## NOTES
* 没有任何语言上的修改
* Flow
  * 对 CompletableFuture 的扩展
  * 支持 ReactiveStream
* G1 为默认 GC
* Jigsaws
  * [Jigsaws Missing Pieces](http://wildfly.org/news/2016/12/12/Jigsaws-Missing-Pieces/)

## JEPs

* 102: [Process API Updates](http://openjdk.java.net/jeps/102)
  * 提升与系统的互操作性
  * 取得当前进程的 PID
    * 以前会比较麻烦,现在只需要 `ProcessHandle.current().pid()`
  * 检测进程是否存活
    * `ProcessHandle.of(pid).map(v->v.isAlive())`
  * 获取进程相关信息
  * 获取进程父子关系
* 110: [HTTP 2 Client](http://openjdk.java.net/jeps/110)
  * HTTP 2.0 客户端
  * WebSocket 客户端
* 143: [Improve Contended Locking](http://openjdk.java.net/jeps/143)
* 158: [Unified JVM Logging](http://openjdk.java.net/jeps/158)
* 165: [Compiler Control](http://openjdk.java.net/jeps/165)
* 193: [Variable Handles](http://openjdk.java.net/jeps/193)
* 197: [Segmented Code Cache](http://openjdk.java.net/jeps/197)
* 199: [Smart Java Compilation, Phase Two](http://openjdk.java.net/jeps/199)
* 200: [The Modular JDK](http://openjdk.java.net/jeps/200)
* 201: [Modular Source Code](http://openjdk.java.net/jeps/201)
* 211: [Elide Deprecation Warnings on Import Statements](http://openjdk.java.net/jeps/211)
* 212: [Resolve Lint and Doclint Warnings](http://openjdk.java.net/jeps/212)
* 213: [Milling Project Coin](http://openjdk.java.net/jeps/213)
  * `@SafeVarargs` 可以用在私有方法
    * 以前只能在静态和私有方法
  * 带资源的 `try` 可以直接使用变量而不需要赋值
    * 以前必须 `try(FileReader fileReader = new FileReader("input"))`, 现在可以 `try(fileReader)`
  * 匿名类的类型参数如果可以推断则可以省略
    * `Comparator<Person> comp = new Comparator<>() {}`
  * 下划线不能作为标识符
    * Java 8 会告警
    * Java 9 会禁止
* 214: [Remove GC Combinations Deprecated in JDK 8](http://openjdk.java.net/jeps/214)
* 215: [Tiered Attribution for javac](http://openjdk.java.net/jeps/215)
* 216: [Process Import Statements Correctly](http://openjdk.java.net/jeps/216)
* 217: [Annotations Pipeline 2.0](http://openjdk.java.net/jeps/217)
* 219: [Datagram Transport Layer Security (DTLS)](http://openjdk.java.net/jeps/219)
* 220: [Modular Run-Time Images](http://openjdk.java.net/jeps/220)
* 221: [Simplified Doclet API](http://openjdk.java.net/jeps/221)
  * `com.sun.javadoc` -> [jdk.javadoc.doclet](http://download.java.net/java/jdk9/docs/jdk/api/javadoc/doclet/jdk/javadoc/doclet/package-summary.html)
* 222: [jshell: The Java Shell (Read-Eval-Print Loop)](http://openjdk.java.net/jeps/222)
  * Java 的 REPL 工具
* 223: [New Version-String Scheme](http://openjdk.java.net/jeps/223)
  * 使用 SemVer 的格式
* 224: [HTML5 Javadoc](http://openjdk.java.net/jeps/224)
* 225: [Javadoc Search](http://openjdk.java.net/jeps/225)
  * 为 Javadoc 提供搜索功能
* 226: [UTF-8 Property Files](http://openjdk.java.net/jeps/226)
* 227: [Unicode 7.0](http://openjdk.java.net/jeps/227)
* 228: [Add More Diagnostic Commands](http://openjdk.java.net/jeps/228)
  * 用于对 HotSpot 进行诊断的新的 `jcmd` 命令
  * `jcmd 1083 VM.stringtable`
* 229: [Create PKCS12 Keystores by Default](http://openjdk.java.net/jeps/229)
* 231: [Remove Launch-Time JRE Version Selection](http://openjdk.java.net/jeps/231)
* 232: [Improve Secure Application Performance](http://openjdk.java.net/jeps/232)
* 233: [Generate Run-Time Compiler Tests Automatically](http://openjdk.java.net/jeps/233)
* 235: [Test Class-File Attributes Generated by javac](http://openjdk.java.net/jeps/235)
* 236: [Parser API for Nashorn](http://openjdk.java.net/jeps/236)
* 237: [Linux/AArch64 Port](http://openjdk.java.net/jeps/237)
* 238: [Multi-Release JAR Files](http://openjdk.java.net/jeps/238)
  * 可以在一个 Jar 中包含针对多个版本的内容
  * 需要在 MANIFEST.MF 中添加 [Multi-Release: true](http://download.java.net/java/jdk9/docs/api/java/util/jar/Attributes.Name.html#MULTI_RELEASE)
  * 会根据版本不同从不同的目录加载更多的内容
    * `META-INF/versions/9`, `META-INF/versions/10`
* 240: [Remove the JVM TI hprof Agent](http://openjdk.java.net/jeps/240)
  * 移除 hprof
  * 早期主要用于堆转储和取得 CPU profile
  * 现在堆转储可以使用 jmap, 而 profile 可以使用 visualvm 等工具
* 241: [Remove the jhat Tool](http://openjdk.java.net/jeps/241)
  * 移除 jhat
  * 用于在浏览器中查看堆状态
* 243: [Java-Level JVM Compiler Interface](http://openjdk.java.net/jeps/243)
* 244: [TLS Application-Layer Protocol Negotiation Extension](http://openjdk.java.net/jeps/244)
* 245: [Validate JVM Command-Line Flag Arguments](http://openjdk.java.net/jeps/245)
* 246: [Leverage CPU Instructions for GHASH and RSA](http://openjdk.java.net/jeps/246)
* 247: [Compile for Older Platform Versions](http://openjdk.java.net/jeps/247)
  * 早期编译时使用 source 和 target 来控制, 现在可以统一使用 release 来控制
  * `--release` 等同于 `-source N -target N -bootclasspath <bootclasspath-from-N>`
  * Java 9 可以针对早期版本的签名做一些处理 `$JDK_HOME/lib/ct.sym`
* 248: [Make G1 the Default Garbage Collector](http://openjdk.java.net/jeps/248)
  * GC 默认使用 G1
  * [Getting Started with the G1 Garbage Collector](http://www.oracle.com/technetwork/tutorials/tutorials-1876574.html)
* 249: [OCSP Stapling for TLS](http://openjdk.java.net/jeps/249)
* 250: [Store Interned Strings in CDS Archives](http://openjdk.java.net/jeps/250)
* 251: [Multi-Resolution Images](http://openjdk.java.net/jeps/251)
  * 支持多分辨率图片 [MultiResolutionImage](http://download.java.net/java/jdk9/docs/api/java/awt/image/MultiResolutionImage.html)
* 252: [Use CLDR Locale Data by Default](http://openjdk.java.net/jeps/252)
* 253: [Prepare JavaFX UI Controls & CSS APIs for Modularization](http://openjdk.java.net/jeps/253)
* 254: [Compact Strings](http://openjdk.java.net/jeps/254)
  * 压缩的字符串格式
  * JVM 的内部优化, 主要考虑是大部分字符都不需要两个字节, 内部使用 byte 数组, 使用编码进行控制.
  * 通过一个额外的字节来标识编码, 最多使用 1 byte 的字符串使用 Latin-1, 其他的使用 UTF16
* 255: [Merge Selected Xerces 2.11.0 Updates into JAXP](http://openjdk.java.net/jeps/255)
* 256: [BeanInfo Annotations](http://openjdk.java.net/jeps/256)
* 257: [Update JavaFX/Media to Newer Version of GStreamer](http://openjdk.java.net/jeps/257)
* 258: [HarfBuzz Font-Layout Engine](http://openjdk.java.net/jeps/258)
* 259: [Stack-Walking API](http://openjdk.java.net/jeps/259)
  * 早期需要使用 `sun.reflect.Reflection::getCallerClass`
  * 现在可以直接遍历调用栈 `StackWalker.getInstance().walk((s) -> s.collect(Collectors.toList()))`
* 260: [Encapsulate Most Internal APIs](http://openjdk.java.net/jeps/260)
  * 将大部分 Java 内部接口(sun., com.sun.)封装在内部模块
  * 但针对常用的内部接口也做了暴露,不过已标识为弃用
    * sun.misc.{Signal,SignalHandler}
    * sun.misc.Unsafe
    * sun.reflect.Reflection::getCallerClass
    * sun.reflect.ReflectionFactory.newConstructorForSerialization
* 261: [Module System](http://openjdk.java.net/jeps/261)
* 262: [TIFF Image I/O](http://openjdk.java.net/jeps/262)
* 263: [HiDPI Graphics on Windows and Linux](http://openjdk.java.net/jeps/263)
* 264: [Platform Logging API and Service](http://openjdk.java.net/jeps/264)
* 265: [Marlin Graphics Renderer](http://openjdk.java.net/jeps/265)
* 266: [More Concurrency Updates](http://openjdk.java.net/jeps/266)
  * 提供 ReactiveStream 实现接口
    * [Flow](http://download.java.net/java/jdk9/docs/api/java/util/concurrent/Flow.html)
      * Flow.Publisher
      * Flow.Subscriber
      * Flow.Subscription
      * Flow.Processor
* 267: [Unicode 8.0](http://openjdk.java.net/jeps/267)
* 268: [XML Catalogs](http://openjdk.java.net/jeps/268)
* 269: [Convenience Factory Methods for Collections](http://openjdk.java.net/jeps/269)
  * 在 List, Set, Map 上添加用于创建不可变集合的辅助类工厂方法 `of`
  * Stream 增强
    * `Stream<T> takeWhile(Predicate<? super T> predicate)`
    * `Stream<T> dropWhile(Predicate<? super T> predicate)`
    * `Stream<T> iterate(T seed, Predicate<? super T> hasNext, UnaryOperator<T> next)`
    * `Stream<T> ofNullable(T t)`
  * Optional 增强
    * `void ifPresentOrElse(Consumer<? super T> action, Runnable emptyAction)`
    * `Optional<T> or(Supplier<? extends Optional<? extends T>> supplier)`
    * `Stream<T> stream()`
* 270: [Reserved Stack Areas for Critical Sections](http://openjdk.java.net/jeps/270)
* 271: [Unified GC Logging](http://openjdk.java.net/jeps/271)
* 272: [Platform-Specific Desktop Features](http://openjdk.java.net/jeps/272)
* 273: [DRBG-Based SecureRandom Implementations](http://openjdk.java.net/jeps/273)
* 274: [Enhanced Method Handles](http://openjdk.java.net/jeps/274)
* 275: [Modular Java Application Packaging](http://openjdk.java.net/jeps/275)
* 276: [Dynamic Linking of Language-Defined Object Models](http://openjdk.java.net/jeps/276)
* 277: [Enhanced Deprecation](http://openjdk.java.net/jeps/277)
  * `@Deprecated` 添加 `forRemoval` 和 `since` 属性
* 278: [Additional Tests for Humongous Objects in G1](http://openjdk.java.net/jeps/278)
* 279: [Improve Test-Failure Troubleshooting](http://openjdk.java.net/jeps/279)
* 280: [Indify String Concatenation](http://openjdk.java.net/jeps/280)
* 281: [HotSpot C++ Unit-Test Framework](http://openjdk.java.net/jeps/281)
* 282: [jlink: The Java Linker](http://openjdk.java.net/jeps/282)
* 283: [Enable GTK 3 on Linux](http://openjdk.java.net/jeps/283)
* 284: [New HotSpot Build System](http://openjdk.java.net/jeps/284)
* 285: [Spin-Wait Hints](http://openjdk.java.net/jeps/285)
  * `java.lang.Thread.onSpinWait()` 用于提示 JVM 进行优化
* 287: [SHA-3 Hash Algorithms](http://openjdk.java.net/jeps/287)
* 288: [Disable SHA-1 Certificates](http://openjdk.java.net/jeps/288)
* 289: [Deprecate the Applet API](http://openjdk.java.net/jeps/289)
  * 废弃所有 Applet 相关接口, 但暂未考虑移除
* 290: [Filter Incoming Serialization Data](http://openjdk.java.net/jeps/290)
* 292: [Implement Selected ECMAScript 6 Features in Nashorn](http://openjdk.java.net/jeps/292)
* 294: [Linux/s390x Port](http://openjdk.java.net/jeps/294)
* 295: [Ahead-of-Time Compilation](http://openjdk.java.net/jeps/295)
* 297: [Unified arm32/arm64 Port](http://openjdk.java.net/jeps/297)



## jdeps --help

```
$ jdeps --help
Usage: jdeps <options> <path ...>]
<path> can be a pathname to a .class file, a directory, a JAR file.

Possible options include:
  -dotoutput <dir>
  --dot-output <dir>            Destination directory for DOT file output
  -s       -summary             Print dependency summary only.
  -v       -verbose             Print all class level dependences
                                Equivalent to -verbose:class -filter:none.
  -verbose:package              Print package-level dependences excluding
                                dependences within the same package by default
  -verbose:class                Print class-level dependences excluding
                                dependences within the same package by default
  -apionly
  --api-only                    Restrict analysis to APIs i.e. dependences
                                from the signature of public and protected
                                members of public classes including field
                                type, method parameter types, returned type,
                                checked exception types etc.
  -jdkinternals
  --jdk-internals               Finds class-level dependences on JDK internal
                                APIs. By default, it analyzes all classes
                                on --class-path and input files unless -include
                                option is specified. This option cannot be
                                used with -p, -e and -s options.
                                WARNING: JDK internal APIs are inaccessible.
  --check <module-name>[,<module-name>...
                                Analyze the dependence of the specified modules
                                It prints the module descriptor, the resulting
                                module dependences after analysis and the
                                graph after transition reduction.  It also
                                identifies any unused qualified exports.
  --generate-module-info <dir>  Generate module-info.java under the specified
                                directory. The specified JAR files will be
                                analyzed. This option cannot be used with
                                --dot-output or --class-path. Use
                                --generate-open-module option for open modules.
  --generate-open-module <dir>  Generate module-info.java for the specified
                                JAR files under the specified directory as
                                open modules. This option cannot be used with
                                --dot-output or --class-path.
  --list-deps                   Lists the dependences and use of JDK internal
                                APIs.
  --list-reduced-deps           Same as --list-deps with not listing
                                the implied reads edges from the module graph
                                If module M1 depends on M2 and M3,
                                M2 requires public on M3, then M1 reading M3 is
                                implied and removed from the module graph.
  -cp <path>
  -classpath <path>
  --class-path <path>           Specify where to find class files
  --module-path <module path>   Specify module path
  --upgrade-module-path <module path>  Specify upgrade module path
  --system <java-home>          Specify an alternate system module path
  --add-modules <module-name>[,<module-name>...]
                                Adds modules to the root set for analysis
  -m <module-name>
  --module <module-name>        Specify the root module for analysis
  --multi-release <version>     Specifies the version when processing
                                multi-release jar files.  <version> should
                                be integer >= 9 or base.

Options to filter dependences:
  -p <pkg>
  -package <pkg>
  --package <pkg>               Finds dependences matching the given package
                                name (may be given multiple times).
  -e <regex>
  -regex <regex>
  --regex <regex>               Finds dependences matching the given pattern.
  --require <module-name>       Finds dependences matching the given module
                                name (may be given multiple times). --package,
                                --regex, --require are mutual exclusive.
  -f <regex> -filter <regex>    Filter dependences matching the given
                                pattern. If given multiple times, the last
                                one will be used.
  -filter:package               Filter dependences within the same package.
                                This is the default.
  -filter:archive               Filter dependences within the same archive.
  -filter:module                Filter dependences within the same module.
  -filter:none                  No -filter:package and -filter:archive
                                filtering.  Filtering specified via the
                                -filter option still applies.


Options to filter classes to be analyzed:
  -include <regex>              Restrict analysis to classes matching pattern
                                This option filters the list of classes to
                                be analyzed.  It can be used together with
                                -p and -e which apply pattern to the dependences
  -P       -profile             Show profile containing a package
  -R       -recursive           Recursively traverse all run-time dependences.
                                The -R option implies -filter:none.  If -p,
                                -e, -f option is specified, only the matching
                                dependences are analyzed.
  -I       --inverse            Analyzes the dependences per other given options
                                and then find all artifacts that directly
                                and indirectly depend on the matching nodes.
                                This is equivalent to the inverse of
                                compile-time view analysis and print
                                dependency summary.  This option must use
                                with --require, --package or --regex option.
  --compile-time                Compile-time view of transitive dependences
                                i.e. compile-time view of -R option.
                                Analyzes the dependences per other given options
                                If a dependence is found from a directory,
                                a JAR file or a module, all classes in that
                                containing archive are analyzed.
  -q       -quiet               Do not show missing dependences from
                                --generate-module-info output.
  -version --version            Version information
```
